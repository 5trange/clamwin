PURPOSE
*******
The main purpose of this document is to have a reminder of the things to do
when building a new version of ClamWin's I18N branch.

RELEASE PROCEDURE
*****************

To Release a new build of the I18N Branch, follow these ordered steps :

1. Generate the .mo files for all languages that need to be included.  This can
   be done by launching the "I18N\clamwin\locale\Convert.bat" script.

2. Open the I18N\clamwin\cpp\MessageTable.mc file with Notepad or another text
   editor that supports UTF-8, and check for untranslated strings that might 
   need to be looked up in and copied from the .po files.
   
   If you change this or any other file from the Explorer Shell extension,
   increment the version in ExplorerShell.rc, to make sure that the dll will
   be replaced on installation.

3. Open I18N\clamwin\Setup\Setup.iss with ISTool and modify the following 
   setting:
      
      OutputBaseFileName=<Filename>

   For the <FileName>, use the format "ClamWin-0.88.7-L10N-28", where 0.88.7 
   is the official release version the branch is merged against, and 28 is 
   the release version of the L10N branch (which will continue to grow until 
   the code is generally accepted and we can merge the I18N branch back to 
   the main branch).

   Optionally, you may need to add .po or .iss files for additional languages.
   We will describe the procedure for adding a language later.

4. Update I18N\clamwin\py\version.py to the new version.  Use the format
   '0.90.1-L10N-32', where 0.90.1 is the official release version the branch
   is merged against, and 32 is the release version of the L10N branch
   (which will continue to grow until the code is generally accepted and we
   can merge the I18N branch back into the main branch)
   
5. Update the file Changelog-I18N, mentioning the new version and changes.

6. Make sure you have the latest Clam exes and dlls in the right folder, as 
   specified in setup.iss (..\..\..\clamav-release\contrib\msvc\Release\).
   You can use the bin folder of the official release for ease.
   The files that should be in there are:
   clamscan.exe, sigtool.exe, freshclam.exe and libclamav.dll
   
7. Build the software package.

8. TEST the software package (at a minimum test the installer and the newly 
   translated texts).

9. Upload the software package and the ChangeLog.

10. Notify the mailing lists and the beta testing forum of the new build.


ADDING A LANGUAGE
*****************
For the explanation here, we will use Brazilian Portuguese as an example.

1. Open clamwin\cpp\MessageTable.mc in a UNICODE text editor.
   Add a line for the language like 'LanguageNames=(Brazilian=0x416:MSG00416)'.
   The code to be used (e.g. 0x416) can be found at 
   http://www.microsoft.com/globaldev/reference/lcid-all.mspx
   
   Also add three lines to the list in this file like this:
        Language=Brazilian
        Examinar com ClamWin Free Antivirus
        .

   This should be enough to compile the string in the shell extension.

2. In clamwin\locale\convert.bat
   - Add the msgfmt command to convert the *.po file to the *.mo file

3. Open clamwin\setup\Setup.iss (and Setup-nodb.iss) and add the following lines:

    - Under [Languages] :
        Name: pt_BR; MessagesFile: compiler:Languages\BrazilianPortuguese.isl
    - Under [Files] :
        Source: ..\locale\pt_BR.mo; DestDir: {app}\locale\pt_BR\LC_MESSAGES; 
            DestName: clamwin.mo; Components: LanguageSupport\Brazilian; 
            Flags: restartreplace uninsrestartdelete replacesameversion
    - Under [Components] :
            Name: LanguageSupport\Brazilian; Description: Portuguese (Brasil); Types: full
    - Under [CustomMessages] :
            #include "..\locale\pt_BR.iss"
            
    To add the manual/help file:
    - Under [Files] :
            Source: ..\doc\pt_BR\Manual_pt.chm; DestDir: {app}\doc; 
                Components: LanguageSupport\Brazilian; Flags: ignoreversion
            Source: ..\doc\pt_BR\Manual_pt.pdf; DestDir: {app}\doc; 
                Components: LanguageSupport\Brazilian; Flags: ignoreversion
    - Under [Icons] :
            Name: {group}\{cm:StartMenuGroupHelp}\{cm:StartMenuGroupHelpInternational}\Brazilian (Brazilian Help); Filename: {app}\doc\Manual_pt.chm; WorkingDir: {app}\bin; Comment: {cm:ClamWinFreeAntivirus2}; Components: LanguageSupport\Brazilian

4. Open clamwin\py\wxDialogPreferences.py and add the language to the choice list:
        AVAILABLE_LANGUAGES = {'pt_BR' : 'Brazilian', 
                               'de_DE' : 'Deutsch',
                               'en_UK' : 'English',
                               'es_ES' : 'Espanol',
                               'fr_FR' : 'Francais',
                               'hu_HU' : 'Hungarian',
                               'it_IT' : 'Italian',
                               'nl_BE' : 'Nederlands',
                               'pl_PL' : 'Polish',
                               'ru_RU' : 'Russian'
                               }